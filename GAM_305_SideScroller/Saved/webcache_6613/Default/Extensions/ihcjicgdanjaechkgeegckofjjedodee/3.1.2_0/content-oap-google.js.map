{"version":3,"file":"content-oap-google.js","mappings":"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","sources":["webpack://browser-guard/./guard-app/content-scripts/content-oap/utils.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/security.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/profile.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/third-party-apps.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/utils.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/devices.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/oap-google.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/index.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/personal-info.ts","webpack://browser-guard/./guard-app/content-scripts/content-oap/google/delete-connection.ts"],"sourcesContent":["export const getAF_initDataCallback = (\n  html: string,\n  hash: 1 | 2,\n  ds: 0 | 1 = 0\n): Array<unknown> | undefined => {\n  let array;\n  const startString = escapeRegex(\n    `AF_initDataCallback({key: 'ds:${ds}', hash: '${hash}', data:`\n  );\n  const endString = \", sideChannel\";\n  const regex = new RegExp(`${startString}(.*?)${endString}`, \"s\");\n\n  const data = html.match(regex)?.[1];\n  if (data) {\n    const isParsable = _isJsonString(data);\n    if (isParsable) {\n      array = JSON.parse(data);\n      return array;\n    } else {\n      throw new Error(\"[ERROR] getAF_initDataCallback: JSON parse\");\n    }\n  } else {\n    throw new Error(\n      \"[ERROR] getAF_initDataCallback: couldn't get AF_initDataCallback\"\n    );\n  }\n};\n\nconst escapeRegex = (string: string) => {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\"); // $& means the whole matched string\n};\n\nconst _isJsonString = (str: string) => {\n  try {\n    JSON.parse(str);\n  } catch (e) {\n    //   console.error(e);\n    return false;\n  }\n  return true;\n};\n\nexport const pruneEmpty = (obj: { [key: string]: string }): unknown => {\n  return (function prune(current) {\n    for (let key in current) {\n      const value = current[key];\n      if (\n        value === undefined ||\n        value === null ||\n        (typeof value === \"string\" && value === \"\") ||\n        (typeof value === \"object\" && _isEmpty(prune(value))) ||\n        (Array.isArray(value) && value.length === 0)\n      ) {\n        delete current[key];\n      }\n    }\n    // remove any leftover undefined values from the delete\n    // operation on an array\n    if (Array.isArray(current)) {\n      pull(current, undefined);\n    }\n\n    return current;\n  })(JSON.parse(JSON.stringify(obj))); // Do not modify the original object, create a clone instead\n};\n\nconst _isEmpty = (value: any) => {\n  if (value === null || value === undefined) {\n    return true;\n  }\n\n  // Check for string, array, and array-like objects\n  if (\n    typeof value === \"string\" ||\n    Array.isArray(value) ||\n    (value.hasOwnProperty(\"length\") && typeof value.length === \"number\")\n  ) {\n    return value.length === 0;\n  }\n\n  // Check for Map and Set\n  if (value instanceof Map || value instanceof Set) {\n    return value.size === 0;\n  }\n\n  // Check for objects\n  for (let key in value) {\n    if (value.hasOwnProperty(key)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nconst pull = (array: unknown[], ...values: unknown[]): unknown[] => {\n  let index = 0;\n  while (index < array.length) {\n    if (\n      values.includes(array[index]) ||\n      (Number.isNaN(array[index]) && values.some((v) => Number.isNaN(v)))\n    ) {\n      array.splice(index, 1);\n    } else {\n      index++;\n    }\n  }\n  return array;\n};\n\nexport type TimeDifference = {\n  years: number;\n  months: number;\n  days: number;\n};\n\nexport function getTimeDifferenceFromToday(year: number): TimeDifference {\n  const today = new Date();\n  const givenYearDate = new Date(year, 0, 1); // January 1 of the given year\n\n  let yearsDifference = today.getFullYear() - year;\n  let monthsDifference = today.getMonth();\n  let daysDifference = today.getDate() - 1; // Subtracting 1 because we started from January 1\n\n  if (givenYearDate > today) {\n    // If the given year is in the future\n    yearsDifference = -yearsDifference;\n    monthsDifference = -monthsDifference;\n    daysDifference = -daysDifference;\n  }\n\n  return {\n    years: yearsDifference,\n    months: monthsDifference,\n    days: daysDifference,\n  };\n}\n\n// Replace your fixed timeouts with element-based waiting\nexport async function waitForElement(selector: string, timeout = 10000): Promise<Element> {\n  return new Promise((resolve, reject) => {\n    const startTime = Date.now();\n    \n    const checkForElement = () => {\n      const element = document.querySelector(selector);\n      if (element) {\n        resolve(element);\n        return;\n      }\n      \n      if (Date.now() - startTime > timeout) {\n        reject(new Error(`Element ${selector} not found within ${timeout}ms`));\n        return;\n      }\n      \n      setTimeout(checkForElement, 100);\n    };\n    \n    checkForElement();\n  });\n}\n","/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport { GoogleSecurityDetails } from \"@/app/scripts/oap/types\";\nimport { getAF_initDataCallback } from \"../utils\";\n\nexport const googleSecurityDetails = async (\n  html: string\n): Promise<GoogleSecurityDetails> => {\n  const array = getAF_initDataCallback(html, 1);\n  const res = extractStrings(array);\n\n  const dataArray = res.filter(\n    // @ts-ignore\n    (a) => !(a.includes(\"/\") || a.includes(\"=\") || !isNaN(Number(a)))\n  );\n\n  try {\n    // @ts-ignore\n    let recoveryEmail = dataArray.find((a) => a.includes(\"@\"));\n    // @ts-ignore\n    const isRecoveryEmailVerified = !recoveryEmail?.includes(\"Verify\");\n\n    if (!isRecoveryEmailVerified) {\n      // @ts-ignore\n      recoveryEmail = recoveryEmail.replace(\"Verify\", \"\").trim();\n    }\n\n    const recoveryPhoneStringIndex = dataArray.findIndex((a) =>\n      // @ts-ignore\n      a.includes(\"Recovery phone\")\n    );\n    const passwordStringIndex = dataArray.findIndex((a) =>\n      // @ts-ignore\n      a.includes(\"Password\")\n    );\n\n    const recoveryPhone = dataArray[recoveryPhoneStringIndex + 1];\n    const passwordLastChange = dataArray[passwordStringIndex + 1];\n    const passwordLastChangeDate = parseDateAndTime(passwordLastChange);\n\n    const res: GoogleSecurityDetails = {\n      // @ts-ignore\n      recoveryPhone: recoveryPhone?.includes(\"Add\") ? undefined : recoveryPhone,\n      recoveryEmail: isRecoveryEmailVerified\n        ? recoveryEmail || undefined\n        : undefined,\n      passwordLastChange: passwordLastChangeDate,\n    };\n\n    console.debug(\"OAP: Google security details dataArray\", JSON.stringify(dataArray, null, 2));\n    const howYouSignInIndex = dataArray.findIndex((a) =>\n      // @ts-ignore\n      a.toLowerCase().startsWith(\"how you sign in to google\")\n    );\n    console.debug(\"OAP: Google security details howYouSignInIndex\", howYouSignInIndex);\n    if (howYouSignInIndex != -1 && dataArray.length >= howYouSignInIndex) {\n      const subArray = dataArray.slice(howYouSignInIndex);\n      const twoStepStrings = subArray.filter((a) => {\n        // @ts-ignore\n        return a.includes(\"2-Step Verification\");\n      });\n      const isOff = twoStepStrings.some((a) => {\n        // @ts-ignore\n        return a.includes(\"off\") || a.includes(\"turned off\");\n      });\n      res.twoFactorStatus = isOff ? \"off\" : \"on\";\n    }\n\n    console.debug(\"OAP: Google security details\", JSON.stringify(res, null, 2));\n    return res;\n  } catch (err) {\n    throw new Error(\"OAP: googleSecurityDetails:\" + err);\n  }\n};\n\nconst extractStrings = (data: unknown) => {\n  let results = [];\n\n  if (Array.isArray(data)) {\n    // If the data is an array, iterate over its elements\n    for (let item of data) {\n      results = results.concat(extractStrings(item));\n    }\n  } else if (typeof data === \"object\" && data !== null) {\n    // If the data is an object (but not null), iterate over its values\n    for (let key in data) {\n      results = results.concat(extractStrings(data[key]));\n    }\n  } else if (\n    typeof data === \"string\" &&\n    data.toLowerCase() !== \"null\" &&\n    data.toLowerCase() !== \"undefined\"\n  ) {\n    // If the data is a string (but not \"null\" or \"undefined\"), add it to the results\n    //@ts-ignore\n    results.push(data);\n  }\n\n  return results;\n};\n\n// Last changed 7 Jun 2022\n// Last changed 7 Jan\n// TODO: test with password change dates that are pretty recent (minutes ago)\nconst parseDateAndTime = (dateStr: string): Date | undefined => {\n  dateStr = dateStr.trim().toLowerCase();\n  // strip the \"last changed\" prefix\n  dateStr = dateStr.replace(\"last changed \", \"\").trim();\n  // check if the dateStr contains a year\n  if (dateStr.includes(\" \")) {\n    const dateParts = dateStr.split(\" \");\n    if (dateParts.length == 2) {\n      // No year, we need to use the current year\n      dateStr = `${dateStr} ${new Date().getFullYear()}`;\n    }\n  }\n  // parse the date\n  const dateObj = new Date(dateStr);\n  if (isNaN(dateObj.getTime())) {\n    return undefined;\n  }\n  return dateObj;\n};\n","import {\n  GoogleProfileInfo,\n  GoogleProfileInfoVisibility,\n} from \"@/app/scripts/oap/types\";\nimport { getAF_initDataCallback } from \"../utils\";\n\nexport const googleProfileInfo = async (\n  html: string\n): Promise<GoogleProfileInfo | undefined> => {\n  const profile: GoogleProfileInfo = {};\n  try {\n    const array = getAF_initDataCallback(html, 2, 1);\n    if (!array) {\n      throw new Error(\"OAP: googleProfile: array is null\");\n    }\n    const flattenDeepRes = array?.flat(Infinity);\n    // console.debug(\"OAP: Flattened profile\", JSON.stringify(flattenDeepRes));\n\n    if (!flattenDeepRes || flattenDeepRes.length === 0) {\n      console.warn(\"OAP: googleProfile: flattenDeepRes is null or empty\");\n      return undefined;\n    }\n\n    const nameIdx = flattenDeepRes.findIndex(\n      (e) => typeof e === \"string\" && e.includes(\"Name \")\n    );\n    if (nameIdx !== -1) {\n      const name = (flattenDeepRes[nameIdx] as string)?.split(\" \")?.[1];\n      const visibilityStr = flattenDeepRes[nameIdx - 2] as string;\n      const nameVisibility = visibilityStr\n        .toLowerCase()\n        .includes(\"visible to anyone\")\n        ? \"public\"\n        : \"private\";\n\n      profile.name = {\n        value: name,\n        visibility: nameVisibility,\n      };\n    }\n\n    const profilePictureTitleIndex =\n      flattenDeepRes.lastIndexOf(\"Profile picture\");\n    if (profilePictureTitleIndex !== -1) {\n      const profilePicVisibilityStr = flattenDeepRes[\n        profilePictureTitleIndex - 2\n      ] as string;\n      const profilePicVisibility = profilePicVisibilityStr\n        .toLowerCase()\n        .includes(\"visible to anyone\")\n        ? \"public\"\n        : \"private\";\n      const profilePicIndex = flattenDeepRes.indexOf(\n        \"A profile picture helps personalise your account\"\n      );\n      const profilePicUrl =\n        profilePicIndex !== -1\n          ? (flattenDeepRes[profilePicIndex - 4] as string)\n          : null;\n      profile.profilePicture = {\n        value: profilePicUrl || undefined,\n        visibility: profilePicVisibility,\n      };\n    }\n\n    const genderIndex = flattenDeepRes.findIndex(\n      (e) => typeof e === \"string\" && e.startsWith(\"Gender \")\n    );\n    if (genderIndex !== -1) {\n      const gender = (flattenDeepRes[genderIndex] as string)?.split(\" \")?.[1];\n      const genderVisibilityStr = flattenDeepRes[genderIndex - 2] as string;\n      const genderVisibility = genderVisibilityStr\n        .toLowerCase()\n        .includes(\"visible to anyone\")\n        ? \"public\"\n        : \"private\";\n\n      profile.gender = {\n        value: gender,\n        visibility: genderVisibility,\n      };\n    }\n\n    const birthdayIndex = flattenDeepRes.findIndex(\n      (e) => typeof e === \"string\" && e.startsWith(\"Birthday \")\n    );\n    if (birthdayIndex !== -1) {\n      const birthday = (flattenDeepRes[birthdayIndex] as string)?.replace(\n        \"Birthday \",\n        \"\"\n      );\n      const birthdayVisibilityStr = flattenDeepRes[birthdayIndex - 2] as string;\n      const birthdayVisibility = birthdayVisibilityStr\n        .toLowerCase()\n        .includes(\"visible to anyone\")\n        ? \"public\"\n        : \"private\";\n\n      profile.birthday = {\n        value: birthday,\n        visibility: birthdayVisibility,\n      };\n    }\n\n    profile.emails = {};\n\n    const googleAccountEmailIndex = flattenDeepRes.findIndex(\n      (e) => typeof e === \"string\" && e.startsWith(\"Google Account email \")\n    );\n    if (googleAccountEmailIndex !== -1) {\n      const googleAccountEmail = (\n        flattenDeepRes[googleAccountEmailIndex] as string\n      )?.replace(\"Google Account email \", \"\");\n      const googleAccountEmailVisibilityStr = flattenDeepRes[\n        googleAccountEmailIndex - 2\n      ] as string;\n      const googleAccountEmailVisibility = googleAccountEmailVisibilityStr\n        .toLowerCase()\n        .includes(\"visible to anyone\")\n        ? \"public\"\n        : \"private\";\n      profile.emails!.googleAccountEmail = {\n        value: googleAccountEmail,\n        visibility: googleAccountEmailVisibility,\n      };\n    }\n\n    // To edit emails \"profile/email/edit?index=1\",\n\n    const emails = [] as Array<{\n      email: string;\n      visibility: GoogleProfileInfoVisibility;\n    }>;\n    for (let i = googleAccountEmailIndex + 1; i < flattenDeepRes.length; i++) {\n      if (\n        !!flattenDeepRes[i] &&\n        typeof flattenDeepRes[i] === \"string\" &&\n        (flattenDeepRes[i] as string).startsWith(\"Email \")\n      ) {\n        const email = (flattenDeepRes[i] as string)?.replace(\"Email \", \"\");\n        const emailVisibilityStr = flattenDeepRes[i - 2] as string;\n        const emailVisibility = emailVisibilityStr\n          .toLowerCase()\n          .includes(\"visible to anyone\")\n          ? \"public\"\n          : \"private\";\n        emails.push({\n          email,\n          visibility: emailVisibility,\n        });\n      }\n    }\n    profile.emails!.otherEmails = emails;\n\n    const placesIndex = flattenDeepRes.findIndex(\n      (e) => typeof e === \"string\" && e.startsWith(\"Places \")\n    );\n    if (placesIndex !== -1) {\n      const currPlace = (flattenDeepRes[placesIndex] as string)?.replace(\n        \"Places \",\n        \"\"\n      );\n      const placesVisibilityStr = flattenDeepRes[placesIndex - 2] as string;\n      const placesVisibility = placesVisibilityStr\n        .toLowerCase()\n        .includes(\"visible to anyone\")\n        ? \"public\"\n        : \"private\";\n      profile.places = {\n        current: currPlace,\n        visibility: placesVisibility,\n      };\n\n      // find previous places\n      const prevPlaceIndex = flattenDeepRes.findIndex(\n        (e) => typeof e === \"string\" && e.startsWith(\"Previous: \")\n      );\n      if (prevPlaceIndex !== -1) {\n        const prevPlace = (flattenDeepRes[prevPlaceIndex] as string)?.replace(\n          \"Previous: \",\n          \"\"\n        );\n        const allPreviousPlaces = prevPlace.split(\";\").map((e) => e.trim());\n        profile.places!.previous = allPreviousPlaces;\n      }\n    }\n\n    const occupationIndex = flattenDeepRes.findIndex(\n      (e) => typeof e === \"string\" && e.startsWith(\"Occupation \")\n    );\n    if (occupationIndex !== -1) {\n      const occupation = (flattenDeepRes[occupationIndex] as string)?.replace(\n        \"Occupation \",\n        \"\"\n      );\n      const occupationVisibilityStr = flattenDeepRes[\n        occupationIndex - 2\n      ] as string;\n      const occupationVisibility = occupationVisibilityStr\n        .toLowerCase()\n        .includes(\"visible to anyone\")\n        ? \"public\"\n        : \"private\";\n      profile.occupation = {\n        value: occupation,\n        visibility: occupationVisibility,\n      };\n    }\n\n    console.debug(\"OAP: Profile Info:\", JSON.stringify(profile, null, 2));\n    return profile;\n  } catch (e) {\n    throw new Error(\"OAP: googleProfile: \" + e);\n  }\n};\n","import { GoogleThirdPartyApp } from \"@/app/scripts/oap/types\";\nimport { getAF_initDataCallback } from \"../utils\";\n\n\nexport const googleThirdPartyApps = async (html: string): Promise<GoogleThirdPartyApp[]> => {\n  const data = getAF_initDataCallback(html, 1);\n  if (!data || !Array.isArray(data)) {\n    return [];\n  }\n\n  if (data.length === 0) {\n    return [];\n  }\n\n  const dataArr: any = data[0];\n  const checkPermissionType = (a: unknown) => {\n    return Array.isArray(a) && a[4] !== undefined && a[4][0] === null;\n  };\n\n  const { signInWithGoogle, accessToAnyAccountAccess } = dataArr.reduce(\n    (acc: Record<string, Array<unknown>>, v: unknown) => {\n      (checkPermissionType(v)\n        ? acc.accessToAnyAccountAccess\n        : acc.signInWithGoogle\n      ).push(v);\n      return acc;\n    },\n    { signInWithGoogle: [], accessToAnyAccountAccess: [] }\n  );\n\n  try {\n    const appsPromises = accessToAnyAccountAccess\n      .map((app: Array<unknown>) => {\n        const baseURL = \"https://myaccount.google.com/connections/overview/\";\n        return baseURL + app[0];\n      })\n      .map((url: string) =>\n        fetch(url, {\n          body: null,\n          method: \"GET\",\n          mode: \"cors\",\n          credentials: \"include\",\n        })\n      );\n\n    const resArray = await Promise.all(appsPromises);\n    const textPromiss = resArray.map((res: any) => res.text());\n\n    const htmlData = await Promise.all(textPromiss);\n\n    const afData = htmlData.map((txt: string) => {\n      return getAF_initDataCallback(txt, 1);\n    });\n\n    console.debug(\"OAP: Google third party apps\", {\n      signInWithGoogle,\n      afData,\n    });\n    const processed = processData([...signInWithGoogle, ...afData]);\n    console.debug(\"OAP: Google third party apps processed\", JSON.stringify(processed, null, 2));\n    return processed;\n  } catch (err) {\n    throw new Error(\"googleThirdPartyApps:\" + err);\n  }\n};\n\nfunction processData(data: Array<unknown>): Array<GoogleThirdPartyApp> {\n  let processedData: any = [];\n\n  processedData = [\n    ...processedData,\n    ...data\n      // @ts-ignore\n      .filter((innerList: any[][]) => !!innerList?.[1]?.[0])\n      // @ts-ignore\n      .map((innerList: any[][][][][]) => {              \n        const appId = innerList[0];\n        // console.debug(\"OAP: Google third party apps id\", id);\n        const name = innerList?.[1]?.[0] || null;\n        if (!name) {\n          console.log(\"name is null\", innerList);\n        }\n\n        const homePage = innerList?.[1]?.[5] || null;\n\n        const accessGivenOnTS = innerList?.[2]?.[0]?.[1]?.[0] || null;\n        const accessGivenOn =\n          typeof accessGivenOnTS === \"number\"\n            ? new Date(accessGivenOnTS * 1000).toISOString()\n            : null;\n\n        const accessGivenTo =\n          innerList?.[2]?.[0]?.[5]?.[0]?.[4]?.[0] || homePage;\n\n        let permissionsArray = innerList?.[2]?.[0]?.[5]?.[0]?.[6];\n        permissionsArray = permissionsArray\n          ? permissionsArray.map((p: any) => {\n              return {\n                title: p?.[0] || \"\",\n                description: p?.[1] || \"\",\n                weight: 1,\n              };\n            })\n          : [\n              {\n                title: \"Basic account info\",\n                description: \"\",\n                weight: 0,\n              },\n            ];\n\n        return {\n          id: appId,\n          name,\n          homePage,\n          permissions: permissionsArray,\n          accessGivenOn,\n          accessGivenTo,\n        };\n      }),\n  ];\n\n  return processedData;\n}\n","export async function extractGoogleAuthQuery(): Promise<{\n  baseURL: string\n  rapt: string\n  authQuery: string\n}> {\n  // wait for window.WIZ_global_data to be defined.\n  // @ts-ignore\n  while (!window.WIZ_global_data) {\n    console.debug('OAP: Waiting for window.WIZ_global_data to be defined')\n    await new Promise((resolve) => setTimeout(resolve, 1000))\n  }\n\n  // @ts-ignore\n  const identifier = window.WIZ_global_data.oPEP7c\n  // @ts-ignore\n  const innerAccountNumber = window.IJ_values[3]\n  // @ts-ignore\n  const baseURL = window.IJ_values[4]\n  // @ts-ignore\n  const rapt = window.WIZ_global_data.Dbw5Ud\n\n  console.debug('OAP: Google identifier', {\n    identifier,\n    rapt,\n    innerAccountNumber,\n    baseURL,\n  })\n\n  const continueLink = `https://myaccount.google.com/security?rapt=${rapt}`\n  const authQuery = `?authuser=${innerAccountNumber}&continue=${encodeURIComponent(\n    continueLink\n  )}&rapt=${rapt}`\n\n  return { baseURL, rapt, authQuery }\n}\n\nexport function buildHeaders(): Record<string, string> {\n  return {\n    Accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n    'Accept-Encoding': 'gzip, deflate, br',\n    'Accept-Language': 'en-US,en;q=0.9',\n    Connection: 'keep-alive',\n    Host: 'myaccount.google.com',\n    'User-Agent': window.navigator.userAgent,\n    Cookie: window.document.cookie,\n  }\n}\n\nexport async function setScanInProgress(inProgress: boolean) {\n  // @ts-ignore\n  window.scanInProgress = inProgress\n}\n\nexport async function checkForCancellation() {\n  console.debug('OAP: Checking for cancellation', {\n    // @ts-ignore\n    scanInProgress: window.scanInProgress,\n  })\n  // @ts-ignore\n  if (window.scanInProgress === false) {\n    throw new Error('OAP: Scan cancelled')\n  }\n}","import { waitForElement } from \"../utils\";\n\nexport type DeviceActivity = {\n  sessionId: string;\n  deviceName: string;\n  model: string;\n  isCurrentSession: boolean;\n};\n\n// export const scrapeDeviceActivityPage = (): Array<DeviceActivity> => {\n//   const devices: DeviceActivity[] = [];\n\n//   try {\n//     const cwizElems = document.querySelectorAll(\n//       'c-wiz[jsrenderer][style*=\"visibility: visible\"]'\n//     );\n//     if (cwizElems.length === 0) {\n//       throw new Error(\"OAP: Google cwiz element not found\");\n//     }\n//     const cwizElem = cwizElems[0];\n\n//     // Find all device sections - they are divs with the specific class pattern\n//     const deviceSections = cwizElem.querySelectorAll(\n//       \".VfPpkd-WsjYwc.VfPpkd-WsjYwc-OWXEXe-INsAgc.KC1dQ.Usd1Ac.AaN0Dd.F2KCCe.NkyfNe.hG48Q\"\n//     );\n\n//     deviceSections.forEach((section, sectionIndex) => {\n//       try {\n//         // Find all device entries within this section\n//         const deviceElements = section.querySelectorAll(\n//           \"li.K6ZZTd.iUwXVd.bs2km.t7ce4c\"\n//         );\n\n//         deviceElements.forEach((deviceElement, deviceIndex) => {\n//           try {\n//             // Extract device ID from the link's data-device-id attribute\n//             const linkElement = deviceElement.querySelector(\n//               \"a[data-device-id]\"\n//             ) as HTMLAnchorElement;\n//             if (!linkElement) {\n//               console.warn(\n//                 `OAP: Device: No link element found for section ${sectionIndex} device ${deviceIndex}`\n//               );\n//               return;\n//             }\n\n//             const deviceId = linkElement.getAttribute(\"data-device-id\");\n//             if (!deviceId) {\n//               console.warn(\n//                 `OAP: Device: No device ID found for section ${sectionIndex} device ${deviceIndex}`\n//               );\n//               return;\n//             }\n\n//             // Extract device name from the element with class \"xpHWl\"\n//             const nameElement = deviceElement.querySelector(\".xpHWl\");\n//             const name = nameElement?.textContent?.trim() || \"\";\n\n//             if (!name) {\n//               console.warn(\n//                 `OAP: Device: No device name found for section ${sectionIndex} device ${deviceIndex}`\n//               );\n//               return;\n//             }\n\n//             // Extract additional device info from PxWk5c container\n//             const detailsContainer = deviceElement.querySelector(\".PxWk5c\");\n//             const detailDivs = detailsContainer?.querySelectorAll(\"div\") || [];\n\n//             // Parse location and model from the detail divs\n//             let model = \"\";\n//             let location = \"\";\n\n//             // Process each div to extract location and model info\n//             for (let i = 0; i < detailDivs.length; i++) {\n//               const div = detailDivs[i];\n//               const text = div.textContent?.trim() || \"\";\n\n//               // Skip empty divs, time indicators, and special elements\n//               if (\n//                 !text ||\n//                 text.includes(\"ago\") ||\n//                 text.includes(\"hour\") ||\n//                 text.includes(\"New\") ||\n//                 text.includes(\"Inactive\") ||\n//                 text.match(\n//                   /^\\d+\\s+(Jul|Jan|Feb|Mar|Apr|May|Jun|Aug|Sep|Oct|Nov|Dec)/\n//                 )\n//               ) {\n//                 continue;\n//               }\n\n//               // First valid text is usually location\n//               if (!location && text) {\n//                 location = text;\n//               }\n//               // Subsequent texts that aren't location are usually browser/app info\n//               else if (text && text !== location) {\n//                 if (!model) {\n//                   model = text;\n//                 } else {\n//                   // If we already have a model, append additional info\n//                   // model = `${model}, ${text}`;\n//                   // model = `${model}, ${text}`;\n//                 }\n//               }\n//             }\n\n//             // Check if this is the current session\n//             const currentSessionIndicator =\n//               deviceElement.querySelector(\".BXHFQ\");\n//             const thisDevice =\n//               currentSessionIndicator?.textContent?.includes(\n//                 \"Your current session\"\n//               ) || false;\n\n//             const device: DeviceActivity = {\n//               sessionId: deviceId,\n//               deviceName: name,\n//               model,\n//               isCurrentSession: thisDevice,\n//             };\n\n//             devices.push(device);\n\n//             console.debug(\n//               `OAP: Device: Extracted section ${sectionIndex} device ${deviceIndex}`,\n//               device\n//             );\n//           } catch (error) {\n//             console.error(\n//               `OAP: Device: Error processing section ${sectionIndex} device ${deviceIndex}`,\n//               error\n//             );\n//           }\n//         });\n//       } catch (error) {\n//         console.error(\n//           `OAP: Device: Error processing section ${sectionIndex}`,\n//           error\n//         );\n//       }\n//     });\n//   } catch (error) {\n//     console.error(\"OAP: Device: Error parsing HTML snippet\", error);\n//   }\n\n//   console.log(\"OAP: Device: Scraped devices from HTML\", {\n//     count: devices.length,\n//     devices,\n//   });\n\n//   return devices;\n// };\n\nexport type DeviceSession = {\n  sessionId: string;\n  pending: boolean;\n  deviceName?: string;\n  deviceType?: string;\n  isThisDevice: boolean;\n  firstSeen?: string;\n  lastSeen?: string;\n  location?: string;\n  formFactorNum?: number;\n  osNum?: number;\n};\n\ntype DeviceSessions = Record<string, DeviceSession>;\n\nexport const scrapeDeviceSessionIDs = async (): Promise<string[]> => {\n  const securityPageLink = document.querySelector('a[href^=\"security\"]');\n  if (!securityPageLink) {\n    throw new Error(\"OAP: Google security page link not found\");\n  }\n  // click it\n  (securityPageLink as HTMLElement).click();\n\n  // Wait for security page to load by looking for device activity link\n  await waitForElement('a[href^=\"device-activity\"]', 10_000);\n  console.debug(\"OAP: Google security page loaded\");\n\n  // find a link with the href that starts with device-activity\n  const deviceActivityLink = document.querySelector(\n    'a[href^=\"device-activity\"]'\n  );\n  if (!deviceActivityLink) {\n    throw new Error(\"OAP: Google device activity link not found\");\n  }\n\n  // click it\n  (deviceActivityLink as HTMLAnchorElement).click();\n\n  // selector for the tag <c-wiz> that has the attribute jsrenderer (don't care about what the value is)\n  await waitForElement(\"c-wiz[jsrenderer]\", 15_000);\n\n  console.debug(\"OAP: Google device activity page loaded with content\");\n\n  // Additional wait for any async content loading\n  await new Promise((resolve) => setTimeout(resolve, 6000));\n  await waitForElement('c-wiz[jsrenderer][style*=\"visibility: visible\"]');\n\n  const sessions: DeviceSessions = {};\n  const deviceIDs: string[] = [];\n\n  try {\n    console.debug(\"OAP: scrapeDeviceSessions: Scraping device sessions\");\n    const cwizElems = document.querySelectorAll(\n      'c-wiz[jsrenderer][style*=\"visibility: visible\"]'\n    );\n    if (cwizElems.length === 0) {\n      console.error(\"OAP: scrapeDeviceSessions: cwiz element not found\");\n      throw new Error(\n        \"OAP: Google scrapeDeviceSessions: cwiz element not found\"\n      );\n    }\n\n    for (let i = 0; i < cwizElems.length; i++) {\n      const cwizElem = cwizElems[i];\n      console.debug(\"OAP: scrapeDeviceSessions: Found cwiz element\", cwizElem);\n    }\n\n    const cwizElem = cwizElems[0];\n    // console.debug(\"OAP: scrapeDeviceSessions: Found cwiz element\", cwizElems);\n\n    // Find all device sections - they are divs with the specific class pattern\n    const deviceSections = cwizElem.querySelectorAll(\n      \".VfPpkd-WsjYwc.VfPpkd-WsjYwc-OWXEXe-INsAgc.KC1dQ.Usd1Ac.AaN0Dd.F2KCCe.NkyfNe.hG48Q\"\n    );\n\n    for (let sectionIdx = 0; sectionIdx < deviceSections.length; sectionIdx++) {\n      const section = deviceSections[sectionIdx];\n\n      // Find all device entries within this section\n      const deviceElements = section.querySelectorAll(\n        \"li.K6ZZTd.iUwXVd.bs2km.t7ce4c\"\n      );\n\n      for (let deviceIdx = 0; deviceIdx < deviceElements.length; deviceIdx++) {\n        const deviceElement = deviceElements[deviceIdx];\n\n        try {\n          // Extract device ID from the link's data-device-id attribute\n          const linkElement = deviceElement.querySelector(\n            \"a[data-device-id]\"\n          ) as HTMLAnchorElement;\n          if (!linkElement) {\n            console.warn(\n              `OAP: scrapeDeviceSessions/deviceElements/${deviceIdx}: No link element found for section ${sectionIdx} device ${deviceIdx}`\n            );\n            continue;\n          }\n\n          const deviceId = linkElement.getAttribute(\"data-device-id\");\n          if (!deviceId) {\n            console.warn(\n              `OAP: scrapeDeviceSessions/deviceElements/${deviceIdx}: No device ID found for section ${sectionIdx} device ${deviceIdx}`\n            );\n            continue;\n          }\n          deviceIDs.push(deviceId);\n\n          // try {\n          //   const sessionDetails = await scrapeDeviceSession(linkElement);\n          //   sessions[deviceId] = sessionDetails;\n          // } catch (sessionErr) {\n          //   console.error(\n          //     `OAP: scrapeDeviceSessions/deviceElements/${deviceIdx}: Error scraping device session for section ${sectionIdx} device ${deviceIdx}`,\n          //     sessionErr\n          //   );\n          // } finally {\n          //   // Go back to the device activity page\n          //   const backButton = document.querySelector(\n          //     'div[role=\"button\"][aria-label=\"Back\"]'\n          //   );\n          //   if (backButton) {\n          //     (backButton as HTMLDivElement).click();\n          //   } else {\n          //     window.history.back();\n          //   }\n          //   await sleep(1_000);\n          // }\n        } catch (deviceElemErr) {\n          console.error(\n            `OAP: scrapeDeviceSessions/deviceElements/${deviceIdx}: Failed to scrape device session: `,\n            deviceElemErr\n          );\n        }\n      }\n\n      console.debug(\n        `OAP: scrapeDeviceSessions/deviceSections/${sectionIdx}: Found ${deviceIDs.length} device IDs`,\n        deviceIDs\n      );\n    }\n  } catch (error) {\n    console.error(\n      \"OAP: scrapeDeviceSessions: Error scraping device sessions\",\n      error\n    );\n  }\n\n  // console.log(\"OAP: scrapeDeviceSessions: Scraped all device sessions\", {\n  //   count: Object.keys(sessions).length,\n  //   sessions,\n  // });\n\n  console.log(\"OAP: scrapeDeviceSessions: Scraped all device session IDs\", {\n    count: deviceIDs.length,\n    deviceIDs,\n  });\n\n  return deviceIDs;\n};\n\n// form factors:\n// 1 - macbook\n// 2 - phone\n// 8 - TV\n\n// oses:\n// 2 - macos\n// 5 - iOS\n// 4 - android tv\n\nexport const scrapeDeviceSessionFromPage = async (\n  deviceId: string\n): Promise<DeviceSession | undefined> => {\n  let deviceName: string | undefined;\n  let formFactorNum: number | undefined;\n  let osNum: number | undefined;\n  let deviceType: string | undefined;\n  let firstSeen: string | undefined;\n  let lastSeen: string | undefined;\n  let location: string | undefined;\n  let isThisDevice: boolean = false;\n  let isSignedOut: boolean = false;\n\n  //<c-wiz jsrenderer=\"XKnbkd\" data-is-webview=\"false\" jsshadow=\"\" jsdata=\"deferred-c16\" data-p=\"%.@.0,null,&quot;IKXKmfT5i-T1NQ&quot;]\" data-node-index=\"1;0\" jsmodel=\"hc6Ubd raOC7d\" c-wiz=\"\">\n  // find the c-wiz element that has a data-p attribute that contains the deviceId. E.g in the example above, the deviceId is \"IKXKmfT5i-T1NQ\"\n  const cwizElems = document.querySelectorAll(`c-wiz`);\n  if (cwizElems.length === 0) {\n    throw new Error(\"OAP: scrapeDeviceSession: No cwiz element found\");\n  }\n\n  // find the c-wiz element that has a data-help-context=DEVICE_ACTIVITY_SCREEN attribute that contains the deviceId. E.g in the example above, the deviceId is \"IKXKmfT5i-T1NQ\"\n  let cwizElem: Element | undefined;\n  for (let i = 0; i < cwizElems.length; i++) {\n    const elem = cwizElems[i] as HTMLElement;\n    // console.debug(\"OAP: scrapeDeviceSession: looking for deviceId\", elem.dataset.p, deviceId);\n    // if (elem.dataset.p?.includes(deviceId)) {\n    //   cwizElem = elem;\n    //   break;\n    // }\n    if (\n      elem.getAttribute(\"data-help-context\") === \"DEVICE_ACTIVITY_SCREEN\" &&\n      elem.dataset.p?.includes(deviceId)\n    ) {\n      cwizElem = elem;\n      break;\n    }\n  }\n\n  if (!cwizElem) {\n    throw new Error(\n      \"OAP: scrapeDeviceSession: No cwiz element found for deviceId: \" +\n        deviceId\n    );\n  }\n\n  console.debug(\n    \"OAP: scrapeDeviceSessionFromPage: Found cwiz element\",\n    cwizElem\n  );\n\n  const formFactorDiv = await scrapeDomChain(cwizElem, [\n    \"div.C2O4Ve\",\n    \"div.D6y2ld\",\n    \"div.kZHi8.EMT5zb\",\n  ]);\n  if (formFactorDiv) {\n    const formFactorStr = (\n      formFactorDiv as HTMLDivElement\n    ).dataset.formFactor?.trim();\n    if (formFactorStr) {\n      formFactorNum = parseInt(formFactorStr);\n      if (isNaN(formFactorNum)) {\n        formFactorNum = undefined;\n        console.warn(\n          \"OAP: scrapeDeviceSession: Invalid form factor number\",\n          formFactorStr\n        );\n      } else {\n        console.debug(\n          \"OAP: scrapeDeviceSession: Form factor number\",\n          formFactorNum\n        );\n      }\n    }\n\n    const osStr = (formFactorDiv as HTMLDivElement).dataset.os?.trim();\n    if (osStr) {\n      osNum = parseInt(osStr);\n      if (isNaN(osNum)) {\n        osNum = undefined;\n        console.warn(\"OAP: scrapeDeviceSession: Invalid OS number\", osStr);\n      } else {\n        console.debug(\"OAP: scrapeDeviceSession: OS number\", osNum);\n      }\n    }\n  }\n\n  const deviceTypeDiv = await scrapeDomChain(cwizElem, [\n    \"div.C2O4Ve\",\n    \"div.FVYsnd\",\n    \"div[role='heading']\",\n  ]);\n  if (deviceTypeDiv) {\n    deviceType = (deviceTypeDiv as HTMLDivElement).textContent?.trim() || \"\";\n  }\n\n  const deviceNameDiv = await scrapeDomChain(cwizElem, [\n    \"div.C2O4Ve\",\n    \"div.FVYsnd\",\n    \"div:nth-child(2)\",\n  ]);\n  if (deviceNameDiv) {\n    deviceName = (deviceNameDiv as HTMLDivElement).textContent?.trim() || \"\";\n  }\n\n  const locationAndLastSeenParentDiv = await scrapeDomChain(cwizElem, [\n    \"div.C2O4Ve\",\n    \"div.tHVeec\",\n  ]);\n  if (locationAndLastSeenParentDiv) {\n    if (locationAndLastSeenParentDiv.childNodes.length == 2) {\n      const locationDiv = locationAndLastSeenParentDiv.childNodes[0];\n      location = (locationDiv as HTMLDivElement).textContent?.trim() || \"\";\n    }\n\n    const lastSeenDiv =\n      locationAndLastSeenParentDiv.childNodes[\n        locationAndLastSeenParentDiv.childNodes.length - 1\n      ];\n    if (lastSeenDiv.textContent?.toLowerCase().includes(\"this device\")) {\n      isThisDevice = true;\n    } else {\n      if (lastSeenDiv.textContent?.toLowerCase().includes(\"learn more\")) {\n        lastSeen = undefined;\n      } else {\n        lastSeen = lastSeenDiv.textContent ?? \"\";\n      }\n    }\n\n    for (let i = 0; i < locationAndLastSeenParentDiv?.childNodes.length; i++) {\n      const childNode = locationAndLastSeenParentDiv.childNodes[i];\n      if (\n        childNode.textContent?.toLowerCase().includes(\"your current session\")\n      ) {\n        isThisDevice = true;\n      } else if (childNode.textContent?.toLowerCase().includes(\"signed out\")) {\n        isSignedOut = true;\n      }\n    }\n  }\n\n  if (isSignedOut) {\n    return undefined;\n  }\n\n  const firstSeenDiv = await scrapeDomChain(cwizElem, [\n    \"div.C2O4Ve\",\n    \"div.cIEMOb\",\n    \"span:last-child\",\n  ]);\n  if (firstSeenDiv) {\n    let firstSeenText = firstSeenDiv.textContent?.trim() || \"\";\n    firstSeenText = firstSeenText.replace(\"First sign-in:\", \"\").trim();\n    firstSeen = firstSeenText;\n  }\n\n  return {\n    deviceName,\n    deviceType,\n    location,\n    sessionId: deviceId,\n    isThisDevice,\n    firstSeen,\n    lastSeen,\n    formFactorNum,\n    osNum,\n    pending: false,\n  };\n};\n\nexport const runDeleteDeviceSession = async (\n  deviceId: string\n): Promise<boolean> => {\n  const cwizElems = document.querySelectorAll(`c-wiz`);\n  if (cwizElems.length === 0) {\n    throw new Error(\"OAP: scrapeDeviceSession: No cwiz element found\");\n  }\n\n  // find the c-wiz element that has a data-help-context=DEVICE_ACTIVITY_SCREEN attribute that contains the deviceId. E.g in the example above, the deviceId is \"IKXKmfT5i-T1NQ\"\n  let cwizElem: Element | undefined;\n  for (let i = 0; i < cwizElems.length; i++) {\n    const elem = cwizElems[i] as HTMLElement;\n    if (\n      elem.getAttribute(\"data-help-context\") === \"DEVICE_ACTIVITY_SCREEN\" &&\n      elem.dataset.p?.includes(deviceId)\n    ) {\n      cwizElem = elem;\n      break;\n    }\n  }\n\n  if (!cwizElem) {\n    throw new Error(\n      \"OAP: scrapeDeviceSession: No cwiz element found for deviceId: \" +\n        deviceId\n    );\n  }\n\n  // find and click the sign out button\n  const signoutTextSelector = \"span.Rju2Ue-TfeOUb-V67aGc\";\n  const signoutElem = cwizElem.querySelector(signoutTextSelector);\n  if (!signoutElem) {\n    throw new Error(\"OAP: scrapeDeviceSession: No sign out element found\");\n  }\n  (signoutElem as HTMLElement).click();\n\n  // sleep for 2 seconds\n  await new Promise((resolve) => setTimeout(resolve, 500));\n  // wait for element (modal) that has a data-cancelids attribute\n  const signoutModal = await waitForElement(\"div[data-cancelids]\", 5_000);\n  if (!signoutModal) {\n    throw new Error(\"OAP: scrapeDeviceSession: No cancel modal found\");\n  }\n\n  const cancelId = signoutModal.getAttribute(\"data-cancelids\");\n  if (!cancelId) {\n    throw new Error(\"OAP: scrapeDeviceSession: No cancel id found\");\n  }\n\n  const signoutActionBtns = signoutModal.querySelectorAll(\"button[data-id]\");\n  if (!signoutActionBtns) {\n    throw new Error(\"OAP: scrapeDeviceSession: No sign out button found\");\n  }\n\n  let signOutBtn: HTMLElement | undefined;\n  for (let i = 0; i < signoutActionBtns.length; i++) {\n    const btn = signoutActionBtns[i] as HTMLElement;\n    const id = btn.getAttribute(\"data-id\");\n    if (id !== cancelId) {\n      signOutBtn = btn;\n      break;\n    }\n  }\n  if (!signOutBtn) {\n    throw new Error(\"OAP: scrapeDeviceSession: No sign out button found\");\n  }\n\n  console.debug(\"OAP: scrapeDeviceSession: Clicking sign out span\", signOutBtn);\n  (signOutBtn as HTMLElement).click();\n  return true;\n};\n\nasync function scrapeDomChain(\n  rootElement: Element,\n  selectorChain: string[]\n): Promise<Element | null> {\n  const combinedSelector = selectorChain\n    .filter((s) => s.trim() !== \"\")\n    .join(\" \");\n  if (!combinedSelector) {\n    return null;\n  }\n  return rootElement.querySelector(combinedSelector);\n}\n","import { googleSecurityDetails } from './security'\nimport { googlePersonalInfo } from './personal-info'\nimport { googleProfileInfo } from './profile'\nimport { googleThirdPartyApps } from './third-party-apps'\nimport {\n  buildHeaders,\n  checkForCancellation,\n  extractGoogleAuthQuery,\n} from './utils'\nimport { GoogleScanResults, GoogleScanType } from '@/app/scripts/oap/types'\nimport { scrapeDeviceSessionFromPage, scrapeDeviceSessionIDs } from './devices'\n\nconst fetchHtml = async (url: string): Promise<string | undefined> => {\n  const headers = buildHeaders()\n  console.debug('OAP: Google fetching url', url)\n  try {\n    const res = await fetch(url, {\n      headers,\n      redirect: 'follow', // Explicitly follow redirects\n    })\n    const html = await res.text()\n    return html\n  } catch (err) {\n    console.error('OAP: Google error fetching url', { url, err })\n    return undefined\n  }\n}\n\nconst googleBaseURL = 'https://myaccount.google.com/'\n\nexport async function runGoogleOAPCheck(\n  pageUrl: string,\n  ignore: GoogleScanType[] = []\n): Promise<{ scanResults: GoogleScanResults; deviceIDs: string[] }> {\n  const { rapt, authQuery } = await extractGoogleAuthQuery()\n  console.log(\n    'OAP: Google auth query',\n    JSON.stringify({ rapt, authQuery }, null, 2)\n  )\n\n  const scanResults: GoogleScanResults = {}\n\n  // scrape third party apps\n  let slug = 'connections'\n  if (!ignore.includes('thirdPartyApps')) {\n    const connectionsHtml = await fetchHtml(`${googleBaseURL}${slug}`)\n    if (!connectionsHtml) {\n      throw new Error('OAP: Google error fetching connections html')\n    }\n    const thirdPartyApps = await googleThirdPartyApps(connectionsHtml)\n    console.debug(\n      'OAP: Scanned Google third party apps',\n      JSON.stringify(thirdPartyApps, null, 2)\n    )\n    scanResults.thirdPartyApps = thirdPartyApps\n    checkForCancellation()\n  }\n\n  // scrape personal info\n  slug = 'personal-info'\n  if (!ignore.includes('profileInfo')) {\n    const personalInfoHtml = await fetchHtml(`${googleBaseURL}${slug}`)\n    if (!personalInfoHtml) {\n      throw new Error('OAP: Google error fetching personal info html')\n    }\n    const personalInfo = await googlePersonalInfo(personalInfoHtml)\n    checkForCancellation()\n  \n    // scrape profile & visibility\n    slug = 'profile'\n    const profileHtml = await fetchHtml(`${googleBaseURL}${slug}`)\n    if (!profileHtml) {\n      throw new Error('OAP: Google error fetching profile html')\n    }\n    const profileInfo = await googleProfileInfo(profileHtml)\n    scanResults.profileInfo = profileInfo\n    checkForCancellation()\n  }\n\n  // scrape security details\n  slug = 'security'\n  if (!ignore.includes('securityDetails')) {\n    const securityHtml = await fetchHtml(`${googleBaseURL}${slug}`)\n    if (!securityHtml) {\n      throw new Error('OAP: Google error fetching security html')\n    }\n    const securityDetails = await googleSecurityDetails(securityHtml)\n    console.debug('OAP: Scanned Google security details', JSON.stringify(securityDetails, null, 2))\n    scanResults.securityDetails = securityDetails\n    checkForCancellation()\n  }\n\n  // scrape device activity\n  // const deviceActivity = await scrapeDeviceSessions();\n  // scanResults.deviceSessions = deviceActivity;\n  let deviceIDs: string[] = []\n  if (!ignore.includes('deviceSessions')) {\n    deviceIDs = await scrapeDeviceSessionIDs()\n    checkForCancellation()\n  }\n\n  return { scanResults, deviceIDs }\n}\n\nexport async function runGoogleThirdpartyAppsCheck(): Promise<GoogleScanResults> {\n  const { rapt, authQuery } = await extractGoogleAuthQuery()\n  console.log(\n    'OAP: Google auth query',\n    JSON.stringify({ rapt, authQuery }, null, 2)\n  )\n\n  const scanResults: GoogleScanResults = {}\n  // scrape third party apps\n  let slug = 'connections'\n  const connectionsHtml = await fetchHtml(`${googleBaseURL}${slug}`)\n  if (!connectionsHtml) {\n    throw new Error('OAP: Google error fetching connections html')\n  }\n  const thirdPartyApps = await googleThirdPartyApps(connectionsHtml)\n  console.debug(\n    'OAP: Scanned Google third party apps',\n    JSON.stringify(thirdPartyApps, null, 2)\n  )\n  scanResults.thirdPartyApps = thirdPartyApps\n\n  return scanResults\n}\n\nexport async function runGoogleProfileInfoCheck(): Promise<GoogleScanResults> {\n  const { rapt, authQuery } = await extractGoogleAuthQuery()\n  console.log(\n    'OAP: Google auth query',\n    JSON.stringify({ rapt, authQuery }, null, 2)\n  )\n\n  const scanResults: GoogleScanResults = {}\n\n  // scrape profile & visibility\n  const slug = 'profile'\n  const profileHtml = await fetchHtml(`${googleBaseURL}${slug}`)\n  if (!profileHtml) {\n    throw new Error('OAP: Google error fetching profile html')\n  }\n  const profileInfo = await googleProfileInfo(profileHtml)\n  scanResults.profileInfo = profileInfo\n\n  return scanResults\n}\n\nexport async function runGoogleSecurityDetailsCheck(): Promise<GoogleScanResults> {\n  const { rapt, authQuery } = await extractGoogleAuthQuery()\n  console.log(\n    'OAP: Google auth query',\n    JSON.stringify({ rapt, authQuery }, null, 2)\n  )\n\n  const scanResults: GoogleScanResults = {}\n\n  // scrape security details\n  const slug = 'security'\n  const securityHtml = await fetchHtml(`${googleBaseURL}${slug}`)\n  if (!securityHtml) {\n    throw new Error('OAP: Google error fetching security html')\n  }\n  const securityDetails = await googleSecurityDetails(securityHtml)\n  scanResults.securityDetails = securityDetails\n\n  return scanResults\n}\n\nexport async function runGoogleDeviceIDCheck(\n  deviceID: string\n): Promise<GoogleScanResults> {\n  const { rapt, authQuery } = await extractGoogleAuthQuery()\n  if (!!rapt) {\n    console.debug('OAP: Yaay! do fetch + AF_initDataCallback')\n  }\n\n  const deviceSession = await scrapeDeviceSessionFromPage(deviceID)\n  if (deviceSession) {\n    const scanResults: GoogleScanResults = {\n      deviceSessions: {\n        [deviceID]: deviceSession,\n      },\n    }\n    return scanResults\n  }\n\n  return { deviceSessions: {} }\n}\n","import {\n  GoogleScanResults,\n  GoogleScanType,\n  GoogleThirdPartyApp,\n  ScanResults,\n} from \"@/app/scripts/oap/types\";\nimport {\n  runGoogleDeviceIDCheck,\n  runGoogleOAPCheck,\n  runGoogleProfileInfoCheck,\n  runGoogleSecurityDetailsCheck,\n  runGoogleThirdpartyAppsCheck,\n} from \"./oap-google\";\nimport { runDeleteConnection } from \"./delete-connection\";\n\nimport { runDeleteDeviceSession, scrapeDeviceSessionIDs } from \"./devices\";\nimport { setScanInProgress } from \"./utils\";\n\n// Robust monkey-patch for window.AF_initDataCallback function\n// This handles cases where the function might be defined before or after our script runs\n// (function setupAF_initDataCallbackInterception() {\n//   // @ts-ignore\n//   let originalAF_initDataCallback = window.AF_initDataCallback\n//   let interceptedData: any[] = []\n//   let isInterceptionActive = false\n\n//   console.debug(\n//     'OAP: Setting up AF_initDataCallback interception, original:',\n//     originalAF_initDataCallback\n//   )\n\n//   // Define our interceptor function\n//   function interceptAF_initDataCallback(data: any) {\n//     console.debug(\n//       'OAP: AF_initDataCallback intercepted with data:',\n//       JSON.stringify(data)\n//     )\n\n//     // Store the intercepted data\n//     interceptedData.push(data)\n\n//     // Call the original function if it existed\n//     if (\n//       originalAF_initDataCallback &&\n//       typeof originalAF_initDataCallback === 'function'\n//     ) {\n//       return originalAF_initDataCallback(data)\n//     }\n\n//     console.debug(\n//       'OAP: No original AF_initDataCallback found, data stored for processing'\n//     )\n//   }\n\n//   function activateInterception() {\n//     if (isInterceptionActive) return\n//     isInterceptionActive = true\n\n//     // Set up the monkey-patch immediately\n//     // @ts-ignore\n//     window.AF_initDataCallback = interceptAF_initDataCallback\n\n//     // Also use Object.defineProperty to ensure our interceptor can't be easily overridden\n//     try {\n//       Object.defineProperty(window, 'AF_initDataCallback', {\n//         get: function () {\n//           return interceptAF_initDataCallback\n//         },\n//         set: function (newFunc) {\n//           console.debug(\n//             'OAP: Attempt to override AF_initDataCallback detected, preserving interception'\n//           )\n//           // Store the new function as the \"original\" but keep our interceptor in place\n//           originalAF_initDataCallback = newFunc\n//         },\n//         configurable: true,\n//         enumerable: true,\n//       })\n//       console.debug(\n//         'OAP: AF_initDataCallback property descriptor set successfully'\n//       )\n//     } catch (e) {\n//       console.warn(\n//         'OAP: Could not set property descriptor for AF_initDataCallback:',\n//         e\n//       )\n//       // Fallback to simple assignment if property descriptor fails\n//       // @ts-ignore\n//       window.AF_initDataCallback = interceptAF_initDataCallback\n//     }\n//   }\n\n//   // Activate interception immediately\n//   activateInterception()\n\n//   // Also watch for script tags that might define AF_initDataCallback later\n//   const observer = new MutationObserver((mutations) => {\n//     mutations.forEach((mutation) => {\n//       mutation.addedNodes.forEach((node) => {\n//         if (node.nodeType === Node.ELEMENT_NODE) {\n//           const element = node as Element\n//           if (element.tagName === 'SCRIPT') {\n//             // Re-activate interception after any script is added\n//             // This ensures our monkey-patch stays in place\n//             setTimeout(() => {\n//               activateInterception()\n//             }, 0)\n//           }\n//         }\n//       })\n//     })\n//   })\n\n//   // Start observing\n//   observer.observe(document.documentElement, {\n//     childList: true,\n//     subtree: true,\n//   })\n\n//   // Expose intercepted data for later access\n//   // @ts-ignore\n//   window._OAP_interceptedAF_initData = interceptedData\n\n//   // Clean up observer when page unloads\n//   window.addEventListener('beforeunload', () => {\n//     observer.disconnect()\n//   })\n// })()\n\n// verify script is loaded\nconsole.log(\n  \"OAP: content-oap-google.js script loaded at\",\n  new Date().toISOString()\n);\n\nasync function runOAPCheckWithOnly(runOnly: GoogleScanType): Promise<{\n  success: boolean;\n  error?: string;\n  results?: ScanResults;\n  deviceIDs?: string[];\n}> {\n  return runOAPCheck(runOnly);\n}\n\nasync function runOAPCheckWithIgnored(ignored: GoogleScanType[]): Promise<{\n  success: boolean;\n  error?: string;\n  results?: ScanResults;\n  deviceIDs?: string[];\n}> {\n  return runOAPCheck(undefined, ignored);\n}\n\nasync function runOAPCheck(runOnly?: GoogleScanType, ignore?: GoogleScanType[]): Promise<{\n  success: boolean;\n  error?: string;\n  results?: ScanResults;\n  deviceIDs?: string[];\n}> {\n  setScanInProgress(true);\n\n  try {\n    const pageUrl = `${window.location.protocol}//${window.location.hostname}`;\n    if (!runOnly) {\n      console.debug(\"OAP: Running OAP check for Google\");\n      const { scanResults, deviceIDs } = await runGoogleOAPCheck(pageUrl, ignore);\n      console.debug(\"OAP: Google check completed successfully\", {\n        scanResults,\n        deviceIDs,\n      });\n      setScanInProgress(false);\n      return { success: true, results: scanResults, deviceIDs };\n    }\n\n    console.debug(\"OAP: Running ONLY OAP check for Google\", { runOnly });\n\n    switch (runOnly) {\n      case \"thirdPartyApps\": {\n        const results = await runGoogleThirdpartyAppsCheck();\n        console.debug(\"OAP: Google check completed successfully\", results);\n        setScanInProgress(false);\n        return { success: true, results };\n      }\n      case \"profileInfo\": {\n        const results = await runGoogleProfileInfoCheck();\n        console.debug(\"OAP: Google check completed successfully\", results);\n        setScanInProgress(false);\n        return { success: true, results };\n      }\n      case \"securityDetails\": {\n        const results = await runGoogleSecurityDetailsCheck();\n        console.debug(\"OAP: Google check completed successfully\", results);\n        setScanInProgress(false);\n        return { success: true, results };\n      }\n      case \"deviceSessions\": {\n        // rescan device sessions\n        // const results = await runGoogleDeviceSessionsCheck()\n        // console.debug('OAP: Google check completed successfully', results)\n        const deviceIDs = await scrapeDeviceSessionIDs()\n        console.debug(\"OAP: Google check completed successfully\", { deviceIDs });\n        setScanInProgress(false);\n        return { success: true, deviceIDs };\n      }\n      default:\n        console.error(\"OAP: Unknown runOnly value\", { runOnly });\n        setScanInProgress(false);\n        return { success: false, error: \"Unknown runOnly value\" };\n    }\n  } catch (error) {\n    console.error(\"OAP: Error during Google check:\", error);\n    setScanInProgress(false);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\nasync function runDeviceIDScan(\n  deviceID: string\n): Promise<{ success: boolean; error?: string; results?: ScanResults }> {\n  try {\n    console.debug(`OAP: Running device ID scan: ${deviceID}`);\n    const scanResults = await runGoogleDeviceIDCheck(deviceID);\n    console.debug(\n      `OAP: Google device ID scan completed successfully: ${deviceID}`,\n      { scanResults }\n    );\n    return { success: true, results: scanResults };\n  } catch (error) {\n    console.error(`OAP: Error during device ID scan: ${deviceID}`, error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\nasync function deleteConnection(app: GoogleThirdPartyApp): Promise<boolean> {\n  console.debug(\"OAP: Deleting connection\", app);\n\n  try {\n    await runDeleteConnection(app);\n    console.debug(\"OAP: Connection deleted\", app);\n    return true;\n  } catch (err) {\n    console.error(\"Error occurred while deleting connection\", err);\n    return false;\n  }\n}\n\nasync function deleteDeviceSession(deviceID: string): Promise<boolean> {\n  try {\n    const success = await runDeleteDeviceSession(deviceID);\n    console.debug(\n      `OAP: Google device ID delete completed successfully: ${deviceID}`,\n      { success }\n    );\n    return success;\n  } catch (error) {\n    console.error(`OAP: Error during device ID scan: ${deviceID}`, error);\n    return false;\n  }\n}\n\nasync function cancelScan() {\n  console.debug(\"OAP: Cancelling scan\");\n  setScanInProgress(false);\n}\n\n// Auto-run when script is injected via chrome.scripting.executeScript\nconsole.log(\n  \"OAP: Script execution context - document.readyState:\",\n  document.readyState,\n  \"location:\",\n  window.location.href\n);\n// register the runOAPCheck function in the window object. This is used by the OAPOrchestrator to run the OAP check.\n// @ts-ignore\nwindow.runOAPCheck = runOAPCheck;\n// @ts-ignore\nwindow.runOAPCheckWithOnly = runOAPCheckWithOnly;\n// @ts-ignore\nwindow.runOAPCheckWithIgnored = runOAPCheckWithIgnored;\n// @ts-ignore\nwindow.runDeviceIDScan = runDeviceIDScan;\n// @ts-ignore\nwindow.deleteConnection = deleteConnection;\n// @ts-ignore\nwindow.deleteDeviceSession = deleteDeviceSession;\n// @ts-ignore\nwindow.cancelScan = cancelScan;\n\nexport { runOAPCheck };\n","import { getAF_initDataCallback, getTimeDifferenceFromToday } from \"../utils\";\n\nexport const googlePersonalInfo = async (html: string) => {\n  try {\n    const array = getAF_initDataCallback(html, 1);\n    if (!array) {\n      throw new Error(\"googlePersonalInfo: array is null\");\n    }\n    const flattenDeepRes = array?.flat(Infinity);\n    // console.debug('OAP: Flattened personal info', JSON.stringify(flattenDeepRes));\n    const birthDay = flattenDeepRes?.find(\n      (e) => typeof e === \"string\" && e.includes(\"Birthday \")\n    );\n    const profilePictureIndex = flattenDeepRes?.indexOf(\"Profile picture\");\n    const profilePicUrl =\n      profilePictureIndex && flattenDeepRes?.[profilePictureIndex + 7];\n    const year = typeof birthDay === \"string\" && birthDay.split(\" \")[3];\n    const age = year ? getTimeDifferenceFromToday(Number(year)) : {};\n    console.debug(\"OAP: Google personal info\", JSON.stringify({ birthDay, profilePicUrl, year, age }, null, 2));\n    return {\n      age,\n      profilePicUrl,\n    };\n  } catch (e) {\n    throw new Error(\"OAP: googlePersonalInfo:\" + e);\n  }\n};\n\n\n","import { GoogleThirdPartyApp } from \"@/app/scripts/oap/types\";\nimport { waitForElement } from \"../utils\";\n\nexport async function runDeleteConnection(app: GoogleThirdPartyApp) {\n  // click the back button until we don't find any back buttons again\n  let hasBackButton = true;\n  while (hasBackButton) {\n    const cwizElems = document.querySelectorAll(\"c-wiz\");\n    let backButton: HTMLDivElement | null = null;\n    for (let i = 0; i < cwizElems.length; i++) {\n      const cwizElem = cwizElems[i] as HTMLElement;\n      if (cwizElem.style.visibility === \"hidden\") {\n        continue;\n      }\n\n      backButton = cwizElem.querySelector(\n        'div[role=\"button\"][aria-label=\"Back\"]'\n      );\n      if (backButton) {\n        break;\n      }\n    }\n\n    if (!backButton) {\n      hasBackButton = false;\n      break;\n    }\n\n    hasBackButton = true;\n    (backButton as HTMLDivElement).click();\n    await new Promise((resolve) => setTimeout(resolve, 1_000));\n  }\n\n  // find a link with the href of \"security\"\n  const securityPageLink = document.querySelector('a[href^=\"security\"]');\n  if (!securityPageLink) {\n    throw new Error(\"OAP: Google security page link not found\");\n  }\n  // click it\n  (securityPageLink as HTMLElement).click();\n\n  // Wait for security page to load by looking for device activity link\n  await waitForElement('a[href^=\"connections\"]', 10_000);\n  console.debug(\"OAP: Google security page loaded\");\n\n  // find a link with the href that starts with connections\n  const connectionsLink = document.querySelector('a[href^=\"connections\"]');\n  if (!connectionsLink) {\n    throw new Error(\"OAP: Google connections link not found\");\n  }\n\n  // click it\n  (connectionsLink as HTMLElement).click();\n\n  await waitForElement(\"ul.u7hyyf\", 10_000);\n\n  const connectionLinks = document.querySelectorAll(\n    'ul.u7hyyf > li.K6ZZTd a[href^=\"connections/overview/\"]'\n  );\n  if (connectionLinks.length === 0) {\n    throw new Error(\"OAP: Google connections links not found\");\n  }\n\n  let targetLink: HTMLAnchorElement | null = null;\n  for (let i = 0; i < connectionLinks.length; i++) {\n    const connectionLink = connectionLinks[i] as HTMLAnchorElement;\n    // Find any descendant div that has text content equal to the app name\n    const appNameDiv = connectionLink.querySelector(\"div.mMsbvc\");\n    if (!appNameDiv) {\n      continue;\n    }\n    if ((appNameDiv as HTMLDivElement).innerText?.trim() === app.name) {\n      console.debug(\"OAP: Google target link found\", connectionLink.href);\n      targetLink = connectionLink;\n      break;\n    }\n  }\n\n  if (!targetLink) {\n    throw new Error(\"OAP: Google target link not found\");\n  }\n\n  targetLink?.click();\n\n  //   <div class=\"MP7fB\" jsname=\"BW4o6d\" data-name=\"Bedtime Story AI\" data-key=\"AXgE0HP_oT0QkteP40ZaGUGXXAY2XYYkNSHeWG_Wy0W-L4a414Qu_O8YwOMvqHJGJUYdrziS0KHTp8Zrw96ITCz7e5U\" aria-hidden=\"false\" role=\"button\" tabindex=\"0\"><div class=\"OZ7tnf\"><div class=\"edUmvf iUwXVd\"><ul class=\"u7hyyf\"><li class=\"K6ZZTd iUwXVd bs2km\"><div class=\"iAwpk lY6Rwe\"><div class=\"eP6Eff\"><div class=\"PLEKud\"><img src=\"https://www.gstatic.com/identity/accountsettings/thirdpartymanagement/DeleteAll_2770596f56bf9b965509f40bd0b330ad.svg\" alt=\"\" role=\"presentation\" height=\"48\" width=\"48\" data-iml=\"747085.900000006\"></div></div><div class=\"GqRghe tXqPBe hv7wl\"><div class=\"mMsbvc \"><div class=\"r8f2z\">Delete all connections that you have with Bedtime Story AI</div></div><div class=\"xsr7od\"><div class=\"Ippjgd\">You can delete the access that youve given to Bedtime Story AI and Google</div></div></div><div class=\"kvjuQc biRLo\"><div class=\"DnDl8e\"><span class=\"notranslate\" aria-hidden=\"true\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" focusable=\"false\" class=\" NMm5M hhikbc\" aria-hidden=\"true\"><path d=\"M9.71 18.71l-1.42-1.42 5.3-5.29-5.3-5.29 1.42-1.42 6.7 6.71z\"></path></svg></span></div></div></div><hr class=\"ejHzw xBaWmd BW2dib FTkAE mFZYMc\"></li></ul><hr class=\"XLj9Xd xBaWmd BW2dib FTkAE mFZYMc\"></div></div></div>\n  const selector = `div.MP7fB[data-name=\"${app.name}\"]`;\n\n  // wait for the page to load\n  await waitForElement(selector, 5_000);\n\n  const deleteButton = document.querySelector(selector);\n  if (!deleteButton) {\n    throw new Error(\"OAP: Google delete button not found\");\n  }\n\n  (deleteButton as HTMLElement).click();\n\n  // wait for the modal to show up and then click the 'confirm' button\n  // button with data-mdc-dialog-action=\"ok\"\n  await waitForElement('button[data-mdc-dialog-action=\"ok\"]', 5_000);\n  const confirmButton = document.querySelector(\n    'button[data-mdc-dialog-action=\"ok\"]'\n  );\n  if (!confirmButton) {\n    throw new Error(\"OAP: Google confirm button not found\");\n  }\n  (confirmButton as HTMLElement).click();\n\n  // wait 2 seconds\n  await new Promise((resolve) => setTimeout(resolve, 2_000));\n\n  console.debug(\"OAP: Google connection deleted, waiting for back button\");\n\n  while (\n    !(\n      window.location.hostname === \"myaccount.google.com\" &&\n      window.location.pathname.startsWith(\"/security\")\n    )\n  ) {\n    console.debug(\"OAP: current window details: \", {\n      href: window.location.href,\n      location: window.location,\n    });\n    console.debug(\"OAP: Clicking back button\");\n    const cwizElems = document.querySelectorAll(\"c-wiz\");\n    for (let i = 0; i < cwizElems.length; i++) {\n      const cwizElem = cwizElems[i] as HTMLElement;\n      if (cwizElem.style.visibility === \"hidden\") {\n        continue;\n      }\n\n      const backButton = cwizElem.querySelector(\n        'div[role=\"button\"][aria-label=\"Back\"]'\n      );\n      if (!backButton) {\n        continue;\n      }\n      (backButton as HTMLDivElement).click();\n      await new Promise((resolve) => setTimeout(resolve, 1_000));\n      break;\n    }\n  }\n\n  console.debug(`OAP: Successfuly deleted connection to ${app.name}`);\n}\n"],"names":["getAF_initDataCallback","html","hash","ds","array","startString","escapeRegex","regex","RegExp","data","match","_isJsonString","JSON","parse","Error","string","replace","str","e","async","waitForElement","selector","timeout","Promise","resolve","reject","startTime","Date","now","checkForElement","element","document","querySelector","setTimeout","googleSecurityDetails","dataArray","extractStrings","filter","a","includes","isNaN","Number","recoveryEmail","find","isRecoveryEmailVerified","trim","recoveryPhoneStringIndex","findIndex","passwordStringIndex","recoveryPhone","passwordLastChange","passwordLastChangeDate","parseDateAndTime","res","undefined","console","debug","stringify","howYouSignInIndex","toLowerCase","startsWith","length","isOff","slice","some","twoFactorStatus","err","results","Array","isArray","item","concat","key","push","dateStr","split","getFullYear","dateObj","getTime","googleProfileInfo","profile","flattenDeepRes","flat","Infinity","warn","nameIdx","name","nameVisibility","value","visibility","profilePictureTitleIndex","lastIndexOf","profilePicVisibility","profilePicIndex","indexOf","profilePicUrl","profilePicture","genderIndex","gender","genderVisibility","birthdayIndex","birthday","birthdayVisibility","emails","googleAccountEmailIndex","googleAccountEmail","googleAccountEmailVisibility","i","email","emailVisibility","otherEmails","placesIndex","currPlace","placesVisibility","places","current","prevPlaceIndex","allPreviousPlaces","map","previous","occupationIndex","occupation","occupationVisibility","googleThirdPartyApps","dataArr","signInWithGoogle","accessToAnyAccountAccess","reduce","acc","v","appsPromises","app","url","fetch","body","method","mode","credentials","textPromiss","all","text","afData","txt","processed","processedData","innerList","appId","log","homePage","accessGivenOnTS","accessGivenOn","toISOString","accessGivenTo","permissionsArray","p","title","description","weight","id","permissions","processData","extractGoogleAuthQuery","window","WIZ_global_data","identifier","oPEP7c","innerAccountNumber","IJ_values","baseURL","rapt","Dbw5Ud","authQuery","encodeURIComponent","setScanInProgress","inProgress","scanInProgress","checkForCancellation","scrapeDeviceSessionIDs","securityPageLink","click","deviceActivityLink","deviceIDs","cwizElems","querySelectorAll","error","cwizElem","deviceSections","sectionIdx","deviceElements","deviceIdx","deviceElement","linkElement","deviceId","getAttribute","deviceElemErr","count","scrapeDomChain","rootElement","selectorChain","combinedSelector","s","join","fetchHtml","headers","Accept","Connection","Host","navigator","userAgent","Cookie","cookie","redirect","googleBaseURL","runOAPCheck","runOnly","ignore","location","protocol","hostname","scanResults","pageUrl","slug","connectionsHtml","thirdPartyApps","personalInfoHtml","birthDay","profilePictureIndex","year","age","today","givenYearDate","yearsDifference","monthsDifference","getMonth","daysDifference","getDate","years","months","days","getTimeDifferenceFromToday","googlePersonalInfo","profileHtml","profileInfo","securityHtml","securityDetails","runGoogleOAPCheck","success","runGoogleThirdpartyAppsCheck","runGoogleProfileInfoCheck","runGoogleSecurityDetailsCheck","message","String","readyState","href","runOAPCheckWithOnly","runOAPCheckWithIgnored","ignored","runDeviceIDScan","deviceID","deviceSession","deviceName","formFactorNum","osNum","deviceType","firstSeen","lastSeen","isThisDevice","isSignedOut","elem","dataset","formFactorDiv","formFactorStr","formFactor","parseInt","osStr","os","deviceTypeDiv","textContent","deviceNameDiv","locationAndLastSeenParentDiv","childNodes","lastSeenDiv","childNode","firstSeenDiv","firstSeenText","sessionId","pending","scrapeDeviceSessionFromPage","deviceSessions","runGoogleDeviceIDCheck","deleteConnection","hasBackButton","backButton","style","connectionsLink","connectionLinks","targetLink","connectionLink","appNameDiv","innerText","deleteButton","confirmButton","pathname","runDeleteConnection","deleteDeviceSession","signoutElem","signoutModal","cancelId","signoutActionBtns","signOutBtn","btn","runDeleteDeviceSession","cancelScan"],"sourceRoot":""}